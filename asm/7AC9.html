<!DOCTYPE html>
<html>
<head>
<title>The Great Escape: Routine at 7AC9</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../TheGreatEscape.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="The Great Escape" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="7AC6.html">7AC6</a>
</td>
<td class="up">Up: <a href="../maps/all.html#7ac9">Map</a></td>
<td class="next">
Next: <a href="7B36.html">7B36</a>
</td>
</tr>
</table>
<div class="description">7AC9: Process player input - fire</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
This checks for the input events triggered by the fire button: 'pick up', 'drop' and 'use'.
</div>
<div class="paragraph">
Used by the routine at <a href="9E07.html">process_player_input</a>.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">A</td>
<td class="register-desc">Input event (type: input_t).</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="asm-label">process_player_input_fire</td>
<td class="address-2"><span id="7ac9"></span>7AC9</td>
<td class="instruction">CP $0A</td>
<td class="comment-1" rowspan="1">Is the input event fire + up?</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7acb"></span>7ACB</td>
<td class="instruction">JP NZ,<a href="7AC9.html#7ad3">process_player_input_fire_0</a></td>
<td class="comment-1" rowspan="1">Test for the next input event if not</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7ace"></span>7ACE</td>
<td class="instruction">CALL <a href="7B36.html">pick_up_item</a></td>
<td class="comment-1" rowspan="1">Call pick_up_item if so</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7ad1"></span>7AD1</td>
<td class="instruction">JR <a href="7AC9.html#7aef">check_for_pick_up_keypress_exit</a></td>
<td class="comment-1" rowspan="1">Then return</td>
</tr>
<tr>
<td class="asm-label">process_player_input_fire_0</td>
<td class="address-2"><span id="7ad3"></span>7AD3</td>
<td class="instruction">CP $0B</td>
<td class="comment-1" rowspan="1">Is the input event fire + down?</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7ad5"></span>7AD5</td>
<td class="instruction">JP NZ,<a href="7AC9.html#7add">process_player_input_fire_1</a></td>
<td class="comment-1" rowspan="1">Test for the next input event if not</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7ad8"></span>7AD8</td>
<td class="instruction">CALL <a href="7B8B.html">drop_item</a></td>
<td class="comment-1" rowspan="1">Call drop_item if so</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7adb"></span>7ADB</td>
<td class="instruction">JR <a href="7AC9.html#7aef">check_for_pick_up_keypress_exit</a></td>
<td class="comment-1" rowspan="1">Then return</td>
</tr>
<tr>
<td class="asm-label">process_player_input_fire_1</td>
<td class="address-2"><span id="7add"></span>7ADD</td>
<td class="instruction">CP $0C</td>
<td class="comment-1" rowspan="1">Is the input event fire + left?</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7adf"></span>7ADF</td>
<td class="instruction">JP NZ,<a href="7AC9.html#7ae7">process_player_input_fire_2</a></td>
<td class="comment-1" rowspan="1">Test for the next input event if not</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7ae2"></span>7AE2</td>
<td class="instruction">CALL <a href="7AC9.html#7af5">use_item_A</a></td>
<td class="comment-1" rowspan="1">Call use_item_A if so</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7ae5"></span>7AE5</td>
<td class="instruction">JR <a href="7AC9.html#7aef">check_for_pick_up_keypress_exit</a></td>
<td class="comment-1" rowspan="1">Then return</td>
</tr>
<tr>
<td class="asm-label">process_player_input_fire_2</td>
<td class="address-2"><span id="7ae7"></span>7AE7</td>
<td class="instruction">CP $0F</td>
<td class="comment-1" rowspan="1">Is the input event fire + right?</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7ae9"></span>7AE9</td>
<td class="instruction">JP NZ,<a href="7AC9.html#7aef">check_for_pick_up_keypress_exit</a></td>
<td class="comment-1" rowspan="1">Test for the next input event if not</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7aec"></span>7AEC</td>
<td class="instruction">CALL <a href="7AC9.html#7af0">use_item_B</a></td>
<td class="comment-1" rowspan="1">Call use_item_B if so</td>
</tr>
<tr>
<td class="asm-label">check_for_pick_up_keypress_exit</td>
<td class="address-2"><span id="7aef"></span>7AEF</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="7af0"></span>
<div class="comments">
<div class="paragraph">
Use item 'B'.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">use_item_B</td>
<td class="address-2"><span id="7af0"></span>7AF0</td>
<td class="instruction">LD A,($8216)</td>
<td class="comment-1" rowspan="1">Fetch the second held item</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7af3"></span>7AF3</td>
<td class="instruction">JR <a href="7AC9.html#7af8">use_item_common</a></td>
<td class="comment-1" rowspan="1">Jump over item 'A' case</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="7af5"></span>
<div class="comments">
<div class="paragraph">
Use item 'A'.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">use_item_A</td>
<td class="address-2"><span id="7af5"></span>7AF5</td>
<td class="instruction">LD A,($8215)</td>
<td class="comment-1" rowspan="1">Fetch the first held item</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="7af8"></span>
<div class="comments">
<div class="paragraph">
Use item common.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">use_item_common</td>
<td class="address-2"><span id="7af8"></span>7AF8</td>
<td class="instruction">CP $FF</td>
<td class="comment-1" rowspan="1">Is the item in <span class="register">A</span> item_NONE? ($FF)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7afa"></span>7AFA</td>
<td class="instruction">RET Z</td>
<td class="comment-1" rowspan="1">Return if so</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7afb"></span>7AFB</td>
<td class="instruction">JR <a href="7AC9.html#7afd">process_player_input_fire_3</a></td>
<td class="comment-1" rowspan="1">Bug: Pointless jump to adjacent instruction</td>
</tr>
<tr>
<td class="asm-label">process_player_input_fire_3</td>
<td class="address-2"><span id="7afd"></span>7AFD</td>
<td class="instruction">ADD A,A</td>
<td class="comment-1" rowspan="5">Point <span class="register">HL</span> at the <span class="register">A'</span>th entry of item_actions_jump_table</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7afe"></span>7AFE</td>
<td class="instruction">LD C,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7aff"></span>7AFF</td>
<td class="instruction">LD B,$00</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7b01"></span>7B01</td>
<td class="instruction">LD HL,$7B16</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7b04"></span>7B04</td>
<td class="instruction">ADD HL,BC</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7b05"></span>7B05</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="4">Fetch the jump table destination address</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7b06"></span>7B06</td>
<td class="instruction">INC HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7b07"></span>7B07</td>
<td class="instruction">LD H,(HL)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7b08"></span>7B08</td>
<td class="instruction">LD L,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7b09"></span>7B09</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="1">Stack the jump table destination address</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7b0a"></span>7B0A</td>
<td class="instruction">LD DE,$81A4</td>
<td class="comment-1" rowspan="4">Copy X,Y and height from the hero's position into saved_pos</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7b0d"></span>7B0D</td>
<td class="instruction">LD HL,$800F</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7b10"></span>7B10</td>
<td class="instruction">LD BC,$0006</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7b13"></span>7B13</td>
<td class="instruction">LDIR</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7b15"></span>7B15</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Jump to the stacked destination address</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="7b16"></span>
<div class="comments">
<div class="paragraph">
Item actions jump table.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">item_actions_jump_table</td>
<td class="address-1"><span id="7b16"></span>7B16</td>
<td class="instruction">DEFW <a href="B417.html">action_wiresnips</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7b18"></span>7B18</td>
<td class="instruction">DEFW <a href="B3F6.html">action_shovel</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7b1a"></span>7B1A</td>
<td class="instruction">DEFW <a href="B495.html">action_lockpick</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7b1c"></span>7B1C</td>
<td class="instruction">DEFW <a href="EFCB.html">action_papers</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7b1e"></span>7B1E</td>
<td class="instruction">DEFW <a href="7AC9.html#7aef">check_for_pick_up_keypress_exit</a></td>
<td class="comment-1" rowspan="1">Return</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7b20"></span>7B20</td>
<td class="instruction">DEFW <a href="B3A8.html">action_bribe</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7b22"></span>7B22</td>
<td class="instruction">DEFW <a href="B3E1.html">action_uniform</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7b24"></span>7B24</td>
<td class="instruction">DEFW <a href="7AC9.html#7aef">check_for_pick_up_keypress_exit</a></td>
<td class="comment-1" rowspan="1">Return</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7b26"></span>7B26</td>
<td class="instruction">DEFW <a href="B3C4.html">action_poison</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7b28"></span>7B28</td>
<td class="instruction">DEFW <a href="B4AE.html">action_red_key</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7b2a"></span>7B2A</td>
<td class="instruction">DEFW <a href="B4B2.html">action_yellow_key</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7b2c"></span>7B2C</td>
<td class="instruction">DEFW <a href="B4B6.html">action_green_key</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7b2e"></span>7B2E</td>
<td class="instruction">DEFW <a href="B387.html">action_red_cross_parcel</a></td>
<td class="comment-1" rowspan="1"></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7b30"></span>7B30</td>
<td class="instruction">DEFW <a href="7AC9.html#7aef">check_for_pick_up_keypress_exit</a></td>
<td class="comment-1" rowspan="1">Return</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7b32"></span>7B32</td>
<td class="instruction">DEFW <a href="7AC9.html#7aef">check_for_pick_up_keypress_exit</a></td>
<td class="comment-1" rowspan="1">Return</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="7b34"></span>7B34</td>
<td class="instruction">DEFW <a href="7AC9.html#7aef">check_for_pick_up_keypress_exit</a></td>
<td class="comment-1" rowspan="1">Return</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="7AC6.html">7AC6</a>
</td>
<td class="up">Up: <a href="../maps/all.html#7ac9">Map</a></td>
<td class="next">
Next: <a href="7B36.html">7B36</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete The Great Escape disassembly 20210529</div>
<div class="copyright">&copy; 1986 Denton Designs &amp; Ocean Software Ltd. (The Great Escape). &copy; 2012-2021 David Thomas (this disassembly).</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 8.4.</div>
</footer>
</body>
</html>