<!DOCTYPE html>
<html>
<head>
<title>The Great Escape: Routine at B3A8</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../TheGreatEscape.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="The Great Escape" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="B387.html">B387</a>
</td>
<td class="up">Up: <a href="../maps/all.html#b3a8">Map</a></td>
<td class="next">
Next: <a href="B3C4.html">B3C4</a>
</td>
</tr>
</table>
<div class="description">B3A8: Action: Bribe</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
This handles the hero bribing a fellow prisoner. It searches through the visible, friendly characters only and returns the first found. The selected character will then pursue the hero. Once they've touched it will accept the bribe (see <a href="CA81.html#ca8d">tr_pursue</a>).
</div>
</div>
</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="b3a8"></span>
<div class="comments">
<div class="paragraph">
Iterate over non-player visible characters.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">action_bribe</td>
<td class="address-2"><span id="b3a8"></span>B3A8</td>
<td class="instruction">LD HL,$8020</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at the second visible character</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="b3ab"></span>B3AB</td>
<td class="instruction">LD B,$07</td>
<td class="comment-1" rowspan="1">Set <span class="register">B</span> for seven iterations</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="b3ad"></span>
<div class="comments">
<div class="paragraph">
Start loop
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">action_bribe_0</td>
<td class="address-2"><span id="b3ad"></span>B3AD</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">Fetch the vischar's character index</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="b3ae"></span>B3AE</td>
<td class="instruction">CP $FF</td>
<td class="comment-1" rowspan="1">Is it character_NONE?</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="b3b0"></span>B3B0</td>
<td class="instruction">JR Z,<a href="B3A8.html#b3b6">action_bribe_1</a></td>
<td class="comment-1" rowspan="1">Jump to the next vischar if so</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="b3b2"></span>B3B2</td>
<td class="instruction">CP $14</td>
<td class="comment-1" rowspan="1">Is it character_20_PRISONER_1?</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="b3b4"></span>B3B4</td>
<td class="instruction">JR NC,<a href="B3A8.html#b3bd">bribe_found</a></td>
<td class="comment-1" rowspan="1">Jump to bribe_found if &gt;=</td>
</tr>
<tr>
<td class="asm-label">action_bribe_1</td>
<td class="address-2"><span id="b3b6"></span>B3B6</td>
<td class="instruction">LD A,$20</td>
<td class="comment-1" rowspan="3">Step to the next vischar</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="b3b8"></span>B3B8</td>
<td class="instruction">ADD A,L</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="b3b9"></span>B3B9</td>
<td class="instruction">LD L,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="b3ba"></span>B3BA</td>
<td class="instruction">DJNZ <a href="B3A8.html#b3ad">action_bribe_0</a></td>
<td class="comment-1" rowspan="1">...loop</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="b3bc"></span>B3BC</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return</td>
</tr>
<tr>
<td class="asm-label">bribe_found</td>
<td class="address-2"><span id="b3bd"></span>B3BD</td>
<td class="instruction">LD ($AF8E),A</td>
<td class="comment-1" rowspan="1">Set the global bribed character to <span class="register">A</span></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="b3c0"></span>B3C0</td>
<td class="instruction">INC L</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at vischar flags</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="b3c1"></span>B3C1</td>
<td class="instruction">LD (HL),$01</td>
<td class="comment-1" rowspan="1">Set flags to vischar_PURSUIT_PURSUE</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="b3c3"></span>B3C3</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="B387.html">B387</a>
</td>
<td class="up">Up: <a href="../maps/all.html#b3a8">Map</a></td>
<td class="next">
Next: <a href="B3C4.html">B3C4</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete The Great Escape disassembly 20240104</div>
<div class="copyright">&copy; 1986 Denton Designs &amp; Ocean Software Ltd. (The Great Escape). &copy; 2012-2024 David Thomas (this disassembly).</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 9.0.</div>
</footer>
</body>
</html>