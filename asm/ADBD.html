<!DOCTYPE html>
<html>
<head>
<title>The Great Escape: Routine at ADBD</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../TheGreatEscape.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="The Great Escape" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="AD59.html">AD59</a>
</td>
<td class="up">Up: <a href="../maps/all.html#adbd">Map</a></td>
<td class="next">
Next: <a href="AE75.html">AE75</a>
</td>
</tr>
</table>
<div class="description">ADBD: Night-time</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
This drives the searchlights. It is called when <a href="A146.html">day_or_night</a> is non-zero.
</div>
<div class="paragraph">
Used by the routine at <a href="9D7B.html">main_loop</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">nighttime</td>
<td class="address-2"><span id="adbd"></span>ADBD</td>
<td class="instruction">LD HL,$81BD</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at searchlight_state</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="adc0"></span>ADC0</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">Fetch the state</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="adc1"></span>ADC1</td>
<td class="instruction">CP $FF</td>
<td class="comment-1" rowspan="1">Is it in searchlight_STATE_SEARCHING state? ($FF)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="adc3"></span>ADC3</td>
<td class="instruction">JP Z,<a href="ADBD.html#ae0d">searching</a></td>
<td class="comment-1" rowspan="1">If so, jump to searching</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="adc6"></span>ADC6</td>
<td class="instruction">LD A,($68A0)</td>
<td class="comment-1" rowspan="1">Fetch the global current room index</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="adc9"></span>ADC9</td>
<td class="instruction">AND A</td>
<td class="comment-1" rowspan="1">Are we outdoors?</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="adca"></span>ADCA</td>
<td class="instruction">JR Z,<a href="ADBD.html#adcf">nighttime_0</a></td>
<td class="comment-1" rowspan="1">If so, jump to searchlight movement code</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="adcc"></span>
<div class="comments">
<div class="paragraph">
If the hero goes indoors then the searchlight loses track.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="adcc"></span>ADCC</td>
<td class="instruction">LD (HL),$FF</td>
<td class="comment-1" rowspan="1">Set the searchlight state to searchlight_STATE_SEARCHING</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="adce"></span>ADCE</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="adcf"></span>
<div class="comments">
<div class="paragraph">
The hero is outdoors.
</div>
<div class="paragraph">
If the searchlight previously caught the hero, then track him.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">nighttime_0</td>
<td class="address-2"><span id="adcf"></span>ADCF</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">Fetch the searchlight state again - it's a counter</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="add0"></span>ADD0</td>
<td class="instruction">CP $1F</td>
<td class="comment-1" rowspan="1">Does it equal searchlight_STATE_CAUGHT? ($1F)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="add2"></span>ADD2</td>
<td class="instruction">JP NZ,<a href="ADBD.html#ae00">nighttime_8</a></td>
<td class="comment-1" rowspan="1">If not, jump to single searchlight code. This will draw the searchlight in the place where the hero was last seen</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="add5"></span>
<div class="comments">
<div class="paragraph">
Caught in searchlight.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="add5"></span>ADD5</td>
<td class="instruction">LD HL,($81BB)</td>
<td class="comment-1" rowspan="1">Fetch map_position into <span class="register">HL</span></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="add8"></span>ADD8</td>
<td class="instruction">LD A,L</td>
<td class="comment-1" rowspan="3">Compute map_x as map_position.x + 4</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="add9"></span>ADD9</td>
<td class="instruction">ADD A,$04</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="addb"></span>ADDB</td>
<td class="instruction">LD E,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="addc"></span>ADDC</td>
<td class="instruction">LD D,H</td>
<td class="comment-1" rowspan="1">map_y is just map_position.y</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="addd"></span>ADDD</td>
<td class="instruction">LD HL,($AE76)</td>
<td class="comment-1" rowspan="1">Fetch the searchlight_caught_coord x/y into <span class="register">HL</span></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ade0"></span>ADE0</td>
<td class="instruction">LD A,L</td>
<td class="comment-1" rowspan="2">Does caught_x equal map_x?</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ade1"></span>ADE1</td>
<td class="instruction">CP E</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ade2"></span>ADE2</td>
<td class="instruction">JR NZ,<a href="ADBD.html#ade9">nighttime_1</a></td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ade4"></span>ADE4</td>
<td class="instruction">LD A,H</td>
<td class="comment-1" rowspan="2">Does caught_y equal map_y?</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ade5"></span>ADE5</td>
<td class="instruction">CP D</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ade6"></span>ADE6</td>
<td class="instruction">RET Z</td>
<td class="comment-1" rowspan="1">If both are equal the highlight doesn't need to move so return</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ade7"></span>ADE7</td>
<td class="instruction">JR <a href="ADBD.html#adf1">nighttime_4</a></td>
<td class="comment-1" rowspan="1">(else)</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="ade9"></span>
<div class="comments">
<div class="paragraph">
Move searchlight left/right to focus on the hero.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">nighttime_1</td>
<td class="address-2"><span id="ade9"></span>ADE9</td>
<td class="instruction">JP NC,<a href="ADBD.html#adef">nighttime_2</a></td>
<td class="comment-1" rowspan="1">Jump to decrement case if caught_x exceeds map_x</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="adec"></span>ADEC</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="1">Increment caught_x</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="aded"></span>ADED</td>
<td class="instruction">JR <a href="ADBD.html#adf0">nighttime_3</a></td>
<td class="comment-1" rowspan="1">(else)</td>
</tr>
<tr>
<td class="asm-label">nighttime_2</td>
<td class="address-2"><span id="adef"></span>ADEF</td>
<td class="instruction">DEC A</td>
<td class="comment-1" rowspan="1">Decrement caught_x</td>
</tr>
<tr>
<td class="asm-label">nighttime_3</td>
<td class="address-2"><span id="adf0"></span>ADF0</td>
<td class="instruction">LD L,A</td>
<td class="comment-1" rowspan="1">Save to <span class="register">HL</span></td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="adf1"></span>
<div class="comments">
<div class="paragraph">
Move searchlight up/down to focus on the hero.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">nighttime_4</td>
<td class="address-2"><span id="adf1"></span>ADF1</td>
<td class="instruction">LD A,H</td>
<td class="comment-1" rowspan="2">Does caught_y equal map_y? (Note: This looks like a duplicated check but isn't - the equivalent above doesn't always execute)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="adf2"></span>ADF2</td>
<td class="instruction">CP D</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="adf3"></span>ADF3</td>
<td class="instruction">JR Z,<a href="ADBD.html#adfd">nighttime_7</a></td>
<td class="comment-1" rowspan="1">Skip movement code if so</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="adf5"></span>ADF5</td>
<td class="instruction">JP NC,<a href="ADBD.html#adfb">nighttime_5</a></td>
<td class="comment-1" rowspan="1">Jump to decrement case if caught_y exceeds map_y</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="adf8"></span>ADF8</td>
<td class="instruction">INC A</td>
<td class="comment-1" rowspan="1">Increment caught_y</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="adf9"></span>ADF9</td>
<td class="instruction">JR <a href="ADBD.html#adfc">nighttime_6</a></td>
<td class="comment-1" rowspan="1">(else)</td>
</tr>
<tr>
<td class="asm-label">nighttime_5</td>
<td class="address-2"><span id="adfb"></span>ADFB</td>
<td class="instruction">DEC A</td>
<td class="comment-1" rowspan="1">Decrement caught_y</td>
</tr>
<tr>
<td class="asm-label">nighttime_6</td>
<td class="address-2"><span id="adfc"></span>ADFC</td>
<td class="instruction">LD H,A</td>
<td class="comment-1" rowspan="1">Save to <span class="register">HL</span></td>
</tr>
<tr>
<td class="asm-label">nighttime_7</td>
<td class="address-2"><span id="adfd"></span>ADFD</td>
<td class="instruction">LD ($AE76),HL</td>
<td class="comment-1" rowspan="1">Save <span class="register">HL</span> back to searchlight_caught_coord</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="ae00"></span>
<div class="comments">
<div class="paragraph">
When tracking the hero a single searchlight is used.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">nighttime_8</td>
<td class="address-2"><span id="ae00"></span>AE00</td>
<td class="instruction">LD DE,($81BB)</td>
<td class="comment-1" rowspan="1">Fetch map_position into <span class="register">HL</span></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae04"></span>AE04</td>
<td class="instruction">LD HL,$AE77</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at searchlight_caught_coord plus a byte to compensate for the 'DEC HL' at the jump target</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae07"></span>AE07</td>
<td class="instruction">LD B,$01</td>
<td class="comment-1" rowspan="1">1 iteration / 1 searchlight</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae09"></span>AE09</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="1">Preserve loop counter</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae0a"></span>AE0A</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="1">Preserve searchlight movement pointer</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae0b"></span>AE0B</td>
<td class="instruction">JR <a href="ADBD.html#ae3f">nighttime_10</a></td>
<td class="comment-1" rowspan="1">Jump</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="ae0d"></span>
<div class="comments">
<div class="paragraph">
When not tracking the hero all three searchlights are cycled through.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">searching</td>
<td class="address-2"><span id="ae0d"></span>AE0D</td>
<td class="instruction">LD HL,$AD29</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at searchlight_movements[0]</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae10"></span>AE10</td>
<td class="instruction">LD B,$03</td>
<td class="comment-1" rowspan="1">3 iterations / 3 searchlights</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="ae12"></span>
<div class="comments">
<div class="paragraph">
Start loop
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">nighttime_9</td>
<td class="address-2"><span id="ae12"></span>AE12</td>
<td class="instruction">PUSH BC</td>
<td class="comment-1" rowspan="1">Preserve loop counter</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae13"></span>AE13</td>
<td class="instruction">PUSH HL</td>
<td class="comment-1" rowspan="1">Preserve searchlight movement pointer</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae14"></span>AE14</td>
<td class="instruction">CALL <a href="AD59.html">searchlight_movement</a></td>
<td class="comment-1" rowspan="1">Decide searchlight movement</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae17"></span>AE17</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="2">Restore searchlight movement pointer</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae18"></span>AE18</td>
<td class="instruction">PUSH HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae19"></span>AE19</td>
<td class="instruction">CALL <a href="AE78.html">searchlight_caught</a></td>
<td class="comment-1" rowspan="1">Is the hero caught in the searchlight?</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae1c"></span>AE1C</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="2">Restore searchlight movement pointer</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae1d"></span>AE1D</td>
<td class="instruction">PUSH HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae1e"></span>AE1E</td>
<td class="instruction">LD DE,($81BB)</td>
<td class="comment-1" rowspan="1">Point <span class="register">DE</span> at map_position</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae22"></span>AE22</td>
<td class="instruction">LD A,E</td>
<td class="comment-1" rowspan="4">If map_x + 23 &lt; searchlight.x (off right hand side) goto next</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae23"></span>AE23</td>
<td class="instruction">ADD A,$17</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae25"></span>AE25</td>
<td class="instruction">CP (HL)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae26"></span>AE26</td>
<td class="instruction">JP C,<a href="ADBD.html#ae6c">next_searchlight</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae29"></span>AE29</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="4">If searchlight.x + 16 &lt; map_x (off left hand side) goto next</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae2a"></span>AE2A</td>
<td class="instruction">ADD A,$10</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae2c"></span>AE2C</td>
<td class="instruction">CP E</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae2d"></span>AE2D</td>
<td class="instruction">JP C,<a href="ADBD.html#ae6c">next_searchlight</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae30"></span>AE30</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at searchlight.y</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae31"></span>AE31</td>
<td class="instruction">LD A,D</td>
<td class="comment-1" rowspan="4">If map_y + 16 &lt; searchlight.y (off top side) goto next</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae32"></span>AE32</td>
<td class="instruction">ADD A,$10</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae34"></span>AE34</td>
<td class="instruction">CP (HL)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae35"></span>AE35</td>
<td class="instruction">JP C,<a href="ADBD.html#ae6c">next_searchlight</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae38"></span>AE38</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="4">If searchlight.y + 16 &lt; map_y (off bottom side) goto next</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae39"></span>AE39</td>
<td class="instruction">ADD A,$10</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae3b"></span>AE3B</td>
<td class="instruction">CP D</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae3c"></span>AE3C</td>
<td class="instruction">JP C,<a href="ADBD.html#ae6c">next_searchlight</a></td>
</tr>
<tr>
<td class="asm-label">nighttime_10</td>
<td class="address-2"><span id="ae3f"></span>AE3F</td>
<td class="instruction">XOR A</td>
<td class="comment-1" rowspan="1">Set the clip flag to zero</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae40"></span>AE40</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-1" rowspan="1">Bank the clip flag</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae41"></span>AE41</td>
<td class="instruction">DEC HL</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at searchlight.x (or caught_coord.x depending on how it was entered)</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="ae42"></span>
<div class="comments">
<div class="paragraph">
Calculate the column
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae42"></span>AE42</td>
<td class="instruction">LD B,$00</td>
<td class="comment-1" rowspan="1">Clear top part of 'column' skip</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae44"></span>AE44</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="2">Calculate the left side skip = searchlight.x - map_x</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae45"></span>AE45</td>
<td class="instruction">SUB E</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae46"></span>AE46</td>
<td class="instruction">JP NC,<a href="ADBD.html#ae4e">nighttime_11</a></td>
<td class="comment-1" rowspan="1">Jump if left hand skip is +ve</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae49"></span>AE49</td>
<td class="instruction">LD B,$FF</td>
<td class="comment-1" rowspan="1">Invert the top part of 'column'</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae4b"></span>AE4B</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-1" rowspan="3">Bitwise complement the banked clip flag</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae4c"></span>AE4C</td>
<td class="instruction">CPL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae4d"></span>AE4D</td>
<td class="instruction">EX AF,AF'</td>
</tr>
<tr>
<td class="asm-label">nighttime_11</td>
<td class="address-2"><span id="ae4e"></span>AE4E</td>
<td class="instruction">LD C,A</td>
<td class="comment-1" rowspan="1">Finalise <span class="register">BC</span> as column</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="ae4f"></span>
<div class="comments">
<div class="paragraph">
Calculate the row
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae4f"></span>AE4F</td>
<td class="instruction">INC HL</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at searchlight.y</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae50"></span>AE50</td>
<td class="instruction">LD A,(HL)</td>
<td class="comment-1" rowspan="1">Fetch searchlight.y</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae51"></span>AE51</td>
<td class="instruction">LD H,$00</td>
<td class="comment-1" rowspan="1">Clear top part of 'row' skip</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae53"></span>AE53</td>
<td class="instruction">SUB D</td>
<td class="comment-1" rowspan="1">Calculate the top side skip = searchlight.y - map_y</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae54"></span>AE54</td>
<td class="instruction">JP NC,<a href="ADBD.html#ae59">nighttime_12</a></td>
<td class="comment-1" rowspan="1">Jump if top side skip is +ve</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae57"></span>AE57</td>
<td class="instruction">LD H,$FF</td>
<td class="comment-1" rowspan="1">Invert the top part of 'row'</td>
</tr>
<tr>
<td class="asm-label">nighttime_12</td>
<td class="address-2"><span id="ae59"></span>AE59</td>
<td class="instruction">LD L,A</td>
<td class="comment-1" rowspan="1">Finalise <span class="register">HL</span> as row</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="ae5a"></span>
<div class="comments">
<div class="paragraph">
<span class="register">HL</span> is row, <span class="register">BC</span> is column
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae5a"></span>AE5A</td>
<td class="instruction">ADD HL,HL</td>
<td class="comment-1" rowspan="5">Multiply row by 32</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae5b"></span>AE5B</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae5c"></span>AE5C</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae5d"></span>AE5D</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae5e"></span>AE5E</td>
<td class="instruction">ADD HL,HL</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae5f"></span>AE5F</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-1" rowspan="1">Add column to it</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae60"></span>AE60</td>
<td class="instruction">LD BC,$5846</td>
<td class="comment-1" rowspan="1">Point <span class="register">HL</span> at the address of the top-left game window attribute</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae63"></span>AE63</td>
<td class="instruction">ADD HL,BC</td>
<td class="comment-1" rowspan="1">Add row+column to base, producing our plot pointer</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae64"></span>AE64</td>
<td class="instruction">EX DE,HL</td>
<td class="comment-1" rowspan="1">Move it to <span class="register">DE</span></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae65"></span>AE65</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-1" rowspan="1">Unbank the clip flag</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae66"></span>AE66</td>
<td class="instruction">LD ($AE75),A</td>
<td class="comment-1" rowspan="1">Assign it to searchlight_clip_left</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae69"></span>AE69</td>
<td class="instruction">CALL <a href="AEB8.html">searchlight_plot</a></td>
<td class="comment-1" rowspan="1">Plot the searchlight</td>
</tr>
<tr>
<td class="asm-label">next_searchlight</td>
<td class="address-2"><span id="ae6c"></span>AE6C</td>
<td class="instruction">POP HL</td>
<td class="comment-1" rowspan="1">Restore searchlight_movement pointer</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae6d"></span>AE6D</td>
<td class="instruction">POP BC</td>
<td class="comment-1" rowspan="1">Restore loop counter</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae6e"></span>AE6E</td>
<td class="instruction">LD DE,$0007</td>
<td class="comment-1" rowspan="2">Step to the next searchlight_movement</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae71"></span>AE71</td>
<td class="instruction">ADD HL,DE</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae72"></span>AE72</td>
<td class="instruction">DJNZ <a href="ADBD.html#ae12">nighttime_9</a></td>
<td class="comment-1" rowspan="1">...loop</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="ae74"></span>AE74</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="AD59.html">AD59</a>
</td>
<td class="up">Up: <a href="../maps/all.html#adbd">Map</a></td>
<td class="next">
Next: <a href="AE75.html">AE75</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete The Great Escape disassembly 20240104</div>
<div class="copyright">&copy; 1986 Denton Designs &amp; Ocean Software Ltd. (The Great Escape). &copy; 2012-2024 David Thomas (this disassembly).</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 9.0.</div>
</footer>
</body>
</html>