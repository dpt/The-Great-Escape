<!DOCTYPE html>
<html>
<head>
<title>The Great Escape: Routine at CB61</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../TheGreatEscape.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="The Great Escape" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="CB2D.html">CB2D</a>
</td>
<td class="up">Up: <a href="../maps/all.html#cb61">Map</a></td>
<td class="next">
Next: <a href="CB75.html">CB75</a>
</td>
</tr>
</table>
<div class="description">CB61: Handle target</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
This is the "didn't hit end of list" case from <a href="CB23.html">get_target_assign_pos</a>. It's not really a routine in its own right.
</div>
<div class="paragraph">
Used by the routine at <a href="CB23.html">get_target_assign_pos</a>.
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">handle_target</td>
<td class="address-2"><span id="cb61"></span>CB61</td>
<td class="instruction">CP $80</td>
<td class="comment-1" rowspan="1">Was the result of get_target get_target_DOOR? ($80)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="cb63"></span>CB63</td>
<td class="instruction">JP NZ,<a href="CB61.html#cb6a">handle_target_0</a></td>
<td class="comment-1" rowspan="1">Jump if not</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="cb66"></span>CB66</td>
<td class="instruction">SET 6,(IY+$01)</td>
<td class="comment-1" rowspan="1">Set vischar.flags flag vischar_FLAGS_TARGET_IS_DOOR</td>
</tr>
<tr>
<td class="asm-label">handle_target_0</td>
<td class="address-2"><span id="cb6a"></span>CB6A</td>
<td class="instruction">POP DE</td>
<td class="comment-1" rowspan="1">Restore the route pointer</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="cb6b"></span>CB6B</td>
<td class="instruction">INC E</td>
<td class="comment-1" rowspan="4">Copy <span class="register">HL</span> (ptr to doorpos or location) to vischar-&gt;target</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="cb6c"></span>CB6C</td>
<td class="instruction">INC E</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="cb6d"></span>CB6D</td>
<td class="instruction">LD BC,$0002</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="cb70"></span>CB70</td>
<td class="instruction">LDIR</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="cb72"></span>CB72</td>
<td class="instruction">LD A,$80</td>
<td class="comment-1" rowspan="1">(This return value is never used)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="cb74"></span>CB74</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="CB2D.html">CB2D</a>
</td>
<td class="up">Up: <a href="../maps/all.html#cb61">Map</a></td>
<td class="next">
Next: <a href="CB75.html">CB75</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete The Great Escape disassembly 20240104</div>
<div class="copyright">&copy; 1986 Denton Designs &amp; Ocean Software Ltd. (The Great Escape). &copy; 2012-2024 David Thomas (this disassembly).</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 9.0.</div>
</footer>
</body>
</html>