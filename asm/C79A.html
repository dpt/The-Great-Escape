<!DOCTYPE html>
<html>
<head>
<title>The Great Escape: Routine at C79A</title>
<meta charset="utf-8" />
<link rel="stylesheet" type="text/css" href="../skoolkit.css" />
<link rel="stylesheet" type="text/css" href="../TheGreatEscape.css" />
</head>
<body class="Asm-c">
<table class="header">
<tr>
<td class="logo"><a href="../index.html"><img alt="The Great Escape" src="../images/logo.png" /></a></td>
<td class="page-header">Routines</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="C6A0.html">C6A0</a>
</td>
<td class="up">Up: <a href="../maps/all.html#c79a">Map</a></td>
<td class="next">
Next: <a href="C7B9.html">C7B9</a>
</td>
</tr>
</table>
<div class="description">C79A: Move towards</div>
<table class="disassembly">
<tr>
<td class="routine-comment" colspan="5">
<div class="details">
<div class="paragraph">
This moves the first value toward the second.
</div>
<div class="paragraph">
Used by the routine at <a href="C6A0.html">move_a_character</a>.
</div>
</div>
<table class="input">
<tr class="asm-input-header">
<th colspan="2">Input</th>
</tr>
<tr>
<td class="register">A'</td>
<td class="register-desc">Largest movement allowed. Either 2 or 6.</td>
</tr>
<tr>
<td class="register">B</td>
<td class="register-desc">Return code. Incremented if delta is zero.</td>
</tr>
<tr>
<td class="register">DE</td>
<td class="register-desc">Pointer to the first value (byte).</td>
</tr>
<tr>
<td class="register">HL</td>
<td class="register-desc">Pointer to the second value (byte).</td>
</tr>
</table>
<table class="output">
<tr class="asm-output-header">
<th colspan="2">Output</th>
</tr>
<tr>
<td class="register">B</td>
<td class="register-desc">Incremented by one when no change.</td>
</tr>
</table>
</td>
</tr>
<tr>
<td class="asm-label">move_towards</td>
<td class="address-2"><span id="c79a"></span>C79A</td>
<td class="instruction">EX AF,AF'</td>
<td class="comment-1" rowspan="3">Set <span class="register">C</span> to the largest movement allowed</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="c79b"></span>C79B</td>
<td class="instruction">LD C,A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="c79c"></span>C79C</td>
<td class="instruction">EX AF,AF'</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="c79d"></span>C79D</td>
<td class="instruction">LD A,(DE)</td>
<td class="comment-1" rowspan="2">delta = first - second</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="c79e"></span>C79E</td>
<td class="instruction">SUB (HL)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="c79f"></span>C79F</td>
<td class="instruction">JR NZ,<a href="C79A.html#c7a3">move_towards_0</a></td>
<td class="comment-1" rowspan="1">Was the delta zero? Jump if not</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="c7a1"></span>
<div class="comments">
<div class="paragraph">
Delta was zero
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="c7a1"></span>C7A1</td>
<td class="instruction">INC B</td>
<td class="comment-1" rowspan="1">Otherwise increment the result by one</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="c7a2"></span>C7A2</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return</td>
</tr>
<tr>
<td class="asm-label">move_towards_0</td>
<td class="address-2"><span id="c7a3"></span>C7A3</td>
<td class="instruction">JR NC,<a href="C79A.html#c7b0">move_towards_2</a></td>
<td class="comment-1" rowspan="1">Was the delta negative? Jump if not</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="c7a5"></span>
<div class="comments">
<div class="paragraph">
Delta was negative
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="c7a5"></span>C7A5</td>
<td class="instruction">NEG</td>
<td class="comment-1" rowspan="1">Get the absolute value</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="c7a7"></span>C7A7</td>
<td class="instruction">CP C</td>
<td class="comment-1" rowspan="3">Clamp the delta to the largest movement</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="c7a8"></span>C7A8</td>
<td class="instruction">JR C,<a href="C79A.html#c7ab">move_towards_1</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="c7aa"></span>C7AA</td>
<td class="instruction">LD A,C</td>
</tr>
<tr>
<td class="asm-label">move_towards_1</td>
<td class="address-2"><span id="c7ab"></span>C7AB</td>
<td class="instruction">LD C,A</td>
<td class="comment-1" rowspan="4">Move the first value towards second</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="c7ac"></span>C7AC</td>
<td class="instruction">LD A,(DE)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="c7ad"></span>C7AD</td>
<td class="instruction">ADD A,C</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="c7ae"></span>C7AE</td>
<td class="instruction">LD (DE),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="c7af"></span>C7AF</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return</td>
</tr>
<tr>
<td class="routine-comment" colspan="5">
<span id="c7b0"></span>
<div class="comments">
<div class="paragraph">
Delta was positive
</div>
</div>
</td>
</tr>
<tr>
<td class="asm-label">move_towards_2</td>
<td class="address-2"><span id="c7b0"></span>C7B0</td>
<td class="instruction">CP C</td>
<td class="comment-1" rowspan="3">Clamp the delta to the largest movement</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="c7b1"></span>C7B1</td>
<td class="instruction">JR C,<a href="C79A.html#c7b4">move_towards_3</a></td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="c7b3"></span>C7B3</td>
<td class="instruction">LD A,C</td>
</tr>
<tr>
<td class="asm-label">move_towards_3</td>
<td class="address-2"><span id="c7b4"></span>C7B4</td>
<td class="instruction">LD C,A</td>
<td class="comment-1" rowspan="4">Move the first value towards second</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="c7b5"></span>C7B5</td>
<td class="instruction">LD A,(DE)</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="c7b6"></span>C7B6</td>
<td class="instruction">SUB C</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="c7b7"></span>C7B7</td>
<td class="instruction">LD (DE),A</td>
</tr>
<tr>
<td class="asm-label"></td>
<td class="address-1"><span id="c7b8"></span>C7B8</td>
<td class="instruction">RET</td>
<td class="comment-1" rowspan="1">Return</td>
</tr>
</table>
<table class="asm-navigation">
<tr>
<td class="prev">
Prev: <a href="C6A0.html">C6A0</a>
</td>
<td class="up">Up: <a href="../maps/all.html#c79a">Map</a></td>
<td class="next">
Next: <a href="C7B9.html">C7B9</a>
</td>
</tr>
</table>
<footer>
<div class="release">The complete The Great Escape disassembly 20240104</div>
<div class="copyright">&copy; 1986 Denton Designs &amp; Ocean Software Ltd. (The Great Escape). &copy; 2012-2024 David Thomas (this disassembly).</div>
<div class="created">Created using <a href="https://skoolkit.ca">SkoolKit</a> 9.0.</div>
</footer>
</body>
</html>